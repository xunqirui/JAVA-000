# 作业内容：
# 1. 使用 GCLogAnalysis.java 自己演练一遍串行/并行/CMS/G1的案例。
# 2. 使用压测工具（wrk或sb），演练gateway-server-0.0.1-SNAPSHOT.jar 示例。
# 根据上述自己对于1和2的演示，写一段对于不同 GC 的总结，提交到 Github。

## 作业运行结果

注：有关时间的地方都是以 ms 来计算

### SerialGC

#### 使用 GCLogAnalysis 进行测试

##### 堆内存为 512 M 测试结果


| 次数 | 生成对象数量 | 平均 Minor GC时间 | 总 Minor GC时间 | 平均 Full GC 时间 | 总 Full GC 时间 |
| ---- | ------------ | ----------------- | --------------- | ----------------- | --------------- |
| 1    | 10231        | 25.6              | 230             | 37                | 370             |
| 2    | 10433        | 21                | 210             | 38.9              | 350             |
| 3    | 10770        | 19                | 190             | 36                | 360             |

##### 堆内存为 1g 测试结果

| 次数 | 生成对象数量 | 平均 Minor GC时间 | 总 Minor GC时间 | 平均 Full GC 时间 | 总 Full GC 时间 |
| ---- | ------------ | ----------------- | --------------- | ----------------- | --------------- |
| 1    | 13818        | 35.8              | 430             | 50                | 50              |
| 2    | 13879        | 35                | 420             | 60                | 60              |
| 3    | 12165        | 43                | 430             | 70                | 70              |

##### 堆内存为 2g 测试结果

| 次数 | 生成对象数量 | 平均 Minor GC时间 | 总 Minor GC时间 | 平均 Full GC 时间 | 总 Full GC 时间 |
| ---- | ------------ | ----------------- | --------------- | ----------------- | --------------- |
| 1    | 11967        | 88                | 440             |                   |                 |
| 2    | 12759        | 73.3              | 440             |                   |                 |
| 3    | 12689        | 75                | 450             |                   |                 |

#### 使用 gateway-server-0.0.1-SNAPSHOT.jar 测试结果

| 堆大小 | 吞吐率(%) | qps      |
| ------ | --------- | -------- |
| 512m   | 97.454    | 54391.55 |
| 1g     | 97.94     | 54417.7  |
| 2g     | 98.689    | 54495.15 |

### ParallelGC

#### 使用 GCLogAnalysis 进行测试

##### 512 M 测试结果

| 次数 | 生成对象数量 | 平均Minor GC 时间 | 总 Minor GC 时间 | 平均 Full GC 时间 | 总 Full GC 时间 |
| ---- | ------------ | ----------------- | ---------------- | ----------------- | --------------- |
| 1    | 8837         | 10.8              | 270              | 1.23              | 26.9            |
| 2    | 9401         | 9.03              | 280              | 1.48              | 28.2            |
| 3    | 8713         | 9.2               | 230              | 1.23              | 30.8            |

##### 1024 m 测试结果

| 次数 | 生成对象数量 | 平均Minor GC 时间 | 总 Minor GC 时间 | 平均 Full GC 时间 | 总 Full GC 时间 |
| ---- | ------------ | ----------------- | ---------------- | ----------------- | --------------- |
| 1    | 13319        | 17.4              | 400              | 2.41              | 40              |
| 2    | 13246        | 17.3              | 380              | 2.34              | 35              |
| 3    | 13416        | 20.5              | 450              | 2.32              | 40              |

##### 2g 测试结果

| 次数 | 生成对象数量 | 平均Minor GC 时间 | 总 Minor GC 时间 | 总M回收量 | 平均 Full GC 时间 | 总 Full GC 时间 | 总 F 回收量 |
| ---- | ------------ | ----------------- | ---------------- | --------- | ----------------- | --------------- | ----------- |
| 1    | 14321        | 52.5              | 420              | 2.68      |                   |                 |             |
| 2    | 13628        | 51.3              | 410              | 2.68      |                   |                 |             |
| 3    | 13757        | 52.5              | 420              | 2.67      |                   |                 |             |

#### 使用 gateway 测试结果

| 堆大小 | 吞吐率(%) | qps      |
| ------ | --------- | -------- |
| 512m   | 98.369    | 54472.83 |
| 1g     | 98.872    | 54419.15 |
| 2g     | 99.378    | 54441.66 |

### CMS

#### 使用 GCLogAnalysis 进行测试

##### 512 M 测试结果

|          | young gc | full gc (concurrent mode failure) | Initial Mark | Concurrent Mark | Concurrent Preclean | Concurrent Abortable Preclean | Final Remark | Concurrent Sweep | Concurrent Reset |
| -------- | -------- | --------------------------------- | ------------ | --------------- | ------------------- | ----------------------------- | ------------ | ---------------- | ---------------- |
| 总时长   | 540      | 40                                | 10           | 0               | 20                  | 170                           | 10           | 20               | 10               |
| 平均时长 | 28.4     | 40                                | 1.11         | 0               | 1.11                | 18.9                          | 1.25         | 2.5              | 1.25             |
|          |          |                                   |              |                 |                     |                               |              |                  |                  |
| 总时长   | 520      | 100                               | 0            | 10              | 0                   | 190                           | 20           | 0                | 0                |
| 平均时长 | 28.9     | 50                                | 0            | 1.25            | 0                   | 23.7                          | 3.33         | 0                | 0                |

##### 1g 测试结果

|          | young gc | full gc (concurrent mode failure) | Initial Mark | Concurrent Mark | Concurrent Preclean | Concurrent Abortable Preclean | Final Remark | Concurrent Sweep | Concurrent Reset |
| -------- | -------- | --------------------------------- | ------------ | --------------- | ------------------- | ----------------------------- | ------------ | ---------------- | ---------------- |
| 总时长   | 420      | 70                                | 10           | 0               | 10                  | 310                           | 0            | 0                | 0                |
| 平均时长 | 35       | 70                                | 5            | 0               | 5                   | 155                           | 0            | 0                | 0                |
|          |          |                                   |              |                 |                     |                               |              |                  |                  |
| 总时长   | 450      | 60                                | 0            | 10              | 0                   | 360                           | 0            | 0                | 0                |
| 平均时长 | 40.9     | 60                                | 0            | 5               | 0                   | 180                           | 0            | 0                | 0                |

##### 2g 测试结果

|          | young gc |
| -------- | -------- |
| 总时长   | 450      |
| 平均时长 | 75       |

#### 使用 gateway 测试结果

|       | qps      | 吞吐率 |
| ----- | -------- | ------ |
| 512m  | 54482.72 | 95.91% |
| 1024m | 54491.79 | 96.976 |
| 2g    | 54558.75 | 98.19% |

### G1

#### 使用 GCLogAnalysis 进行测试

##### 512 M 测试结果

|          | mixed gc | young gc | concurrent mark | cleanup |
| -------- | -------- | -------- | --------------- | ------- |
| 总时长   | 103      | 89.5     | 32.6            | 21.8    |
| 平均时长 | 3.56     | 2.89     | 1.05            | 0.728   |
|          |          |          |                 |         |
| 总时长   | 111      | 107      | 21              | 20.8    |
| 平均时长 | 3.69     | 3.46     | 0.751           | 0.742   |

##### 1 g 测试结果

|          | mixed gc | young gc | concurrent mark | cleanup |
| -------- | -------- | -------- | --------------- | ------- |
| 总时长   | 58.1     | 201      | 7.49            | 4.87    |
| 平均时长 | 5.28     | 15.5     | 1.25            | 0.812   |
|          |          |          |                 |         |
| 总时长   | 57       | 136      | 7.89            | 6.48    |
| 平均时长 | 5.7      | 10.5     | 1.13            | 0.926   |

##### 2 g 测试结果

|          | mixed | young gc | concurrent mark | cleanup | total |
| -------- | ----- | -------- | --------------- | ------- | ----- |
| 总时长   |       | 293      | 4.29            | 1.21    | 299   |
| 平均时长 |       | 22.6     | 4.29            | 1.21    | 19.9  |
|          |       |          |                 |         |       |
| 总时长   |       | 227      |                 |         |       |
| 平均时长 |       | 20.6     |                 |         |       |

#### 使用 gateway 测试结果

|       | qps      | 吞吐率 |
| ----- | -------- | ------ |
| 512M  | 54454.3  | 98.79% |
| 1024m | 54498.26 | 99.10% |
| 2g    | 54549.42 | 99.23% |

## 不同 gc 总结

​		由于 GCLogAnalysis 产生对象的随机性，所以通过对象量来对比没有很大的对比性，而通过 gateway 的压测能够更直观的查看到不同 GC 的吞吐量的区别。

​		通过图表分析表明，在吞吐量上 G1 > ParallelGC > SerialGC > CMS，G1 在注重低延迟的同时，吞吐量上面也有很好的表现，而 CMS 在注重低延迟的同时，吞吐量上却有显著的降低，CMS 在 full gc 时的时长主要都花费在并行执行的阶段，实际 STW 阶段花费的时间较少。随着堆内存的扩大，full gc 的次数降低，同时 young gc 的时间也变长，但是吞吐量提升了，因为堆内存的增大，可以容纳的对象变多了，同时 gc 的次数降低了。SerialGC 总的来说比较中庸，只能适用于单核的情况，并行 GC 的吞吐量上有很好的表现，所以在需要后台大量计算的场景中可以使用，而 CMS 了话因为注重低延迟，所以在比较注重延迟的环境上，例如 B/S 系统上可以使用，G1 了话在内存小的时候，与并行 GC 没有很大的区别，如果堆内存需求要大并且需要低延迟的时候，可以使用。